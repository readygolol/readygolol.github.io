<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<title>playHistory patch 20200914</title>
<style type="text/css">
    
    div {
        font-family: "Microsoft JhengHei", "Arial";
        font-size: 20px;
		font-weight: 500;
		color: black;
    }
	

</style>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript">

	var channel = "dumbting"
		
        $(document).ready(function() {
			var url = location.href
			if(url.indexOf('?ch=')!=-1){
			channel = url.split('?ch=')[1]
			}
			
		var alllist = [];

            //playHistory
            $.getJSON("https://api.streamersonglist.com/v1/streamers/"+ channel +"/playHistory?size=500&current=0&type=playedAt&order=desc&period=all", function(result) {
                $.each(result.items, function(i, field) {
				if (field.requests[0].name == channel) {
					alllist.push(field.song.title + " - " + field.requests[0].name + " - " + new Date(field.playedAt).toLocaleDateString('zh-TW', {timeZone: 'Asia/Taipei'}) + " " + new Date(field.playedAt).toTimeString().split("GMT+0800 (台北標準時間)")[0])
					}
				});

					$(playHistory).append( channel +" 台點播表</br></br>" + alllist.join("@$").replace(/\@\$/g, "</br>"))

            });
        });
    </script>
</head>

<body>

    <div id="playHistory"></div>
	
</body>

</html>
